clear%%%bond energy model
% % close all
all_BEM=load('./all_BEM.txt');
h=6.63*10^(-34)/(1.6*10^(-19))/2/3.14; 
k=1.38*10^(-23)/(1.6*10^(-19));
T_max=1000;
T=10:10:T_max;
n_mu_T=[];
%delta_mu=[-1.5:0.001:-0.7];%%mu_Si-mu_Ge
delta_mu=[-1.35:0.01:-1];%%plot predict phase diagram 
n_str_max=zeros(size(delta_mu,2),T_max/10);
for zz=1:size(delta_mu,2)
    zz
H=all_BEM(:,2)*delta_mu(1,zz)-all_BEM(:,3);
H=H-max(H)*ones(size(H,1),1);
H=-H;

Z_all=[];
for ii= 1:size(T,2)
  z_i=[];

for rr=1:size(H,1)
    z=exp(-H(rr,1)/k/T(ii));
    z_i=[z_i;z];
end
Z_all=[Z_all   z_i];
end%%% Z = sum(g_i*z_i)        z_i from $9.7 wangzhicheng

Z_all_norm=Z_all;
for xx=1:size(Z_all,2)
    Z_all_norm(:,xx)=Z_all(:,xx).*all_BEM(:,4)/(Z_all(:,xx)'*all_BEM(:,4));
end%normalization

[x,m]=max(Z_all_norm);
for ww=1:size(x,2)
if x(1,ww)>0.3%%%%structure which is more than 30% and dominant
n_str_max(zz,ww)=m(1,ww);
else
n_str_max(zz,ww)=0;
end
end

E_n=[];
for ll=1:size(Z_all,2)
    en=Z_all(:,ll)'*(all_BEM(:,2).*all_BEM(:,4))/(Z_all(:,ll)'*all_BEM(:,4));
    E_n=[E_n en];
end
n_mu_T=[n_mu_T;E_n];
end
%%%%%%%%%%%%
%plot predict phase diagram
%%%%%%%%%%%%%
 n_str_max= imrotate(n_str_max,90);
 te=unique(n_str_max);
 n_str_max_p=zeros(size(n_str_max,1),size(n_str_max,2));
  for ii=1:size(n_str_max,1)
     for jj=1:size(n_str_max,2)
       n_str_max_p(ii,jj)=find(te==n_str_max(ii,jj));
     end
 end
 figure 
 set(gcf,'color','white');
 image(n_str_max_p,'CDataMapping','scaled')
 hold on
 for ii=1:9
    text(-70,ii*200,num2str(2000-ii*200),'FontSize',10)
    
end
for ii=1:8
text(ii*100-20,2050,num2str(-1.5+ii*0.1),'FontSize',10)
end
% text(35,1000,'2','FontSize',10)
% text(75,1750,'53','FontSize',10)
% text(85,1900,'70','FontSize',10)
% text(117,1800,'76','FontSize',10)
% text(147,1700,'85','FontSize',10)
% text(190,1600,'88','FontSize',10)
% text(300,1600,'89','FontSize',10)
% text(3,1400,'90','FontSize',10)
% title('predict phase(>30%)')
 axis off
 %%%%%%%%%%%%%%